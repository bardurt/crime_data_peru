<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crime Map - Lima</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <style>
    body, html { margin: 0; height: 100%; }
    #map { width: 100%; height: 100%; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    const map = L.map('map').setView([-12.05, -77.03], 11);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const csvFile = '2026.csv';

    fetch(csvFile)
      .then(response => response.text())
      .then(csvText => {
        Papa.parse(csvText, {
          header: false,
          skipEmptyLines: true,
          complete: function(results) {
            const data = results.data;

            data.forEach(row => {
              const [date, crime_type, victim_gender, lat, lng] = row;
              L.circleMarker([parseFloat(lat), parseFloat(lng)], {
                radius: 5,
                color: 'red',
                fillOpacity: 0.7
              }).bindPopup(`
                <b>Date:</b> ${date}<br>
                <b>Crime type:</b> ${crime_type}<br>
                <b>Victim gender:</b> ${victim_gender}
              `).addTo(map);
            });

            const latLngs = data.map(r => [parseFloat(r[3]), parseFloat(r[4])]);
            const bounds = L.latLngBounds(latLngs);
            map.fitBounds(bounds);
          }
        });
      })
      .catch(err => console.error('Error loading CSV:', err));
  </script>
</body>
</html>
